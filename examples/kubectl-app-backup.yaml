name: kubectl-app-backup
description: Application-specific backup strategies using kubectl

steps:
  - name: postgres-dump
    run: kubectl exec postgres-pod -- pg_dump -U postgres mydatabase | gzip
    output: file:backup-postgres-$(date +%Y%m%d-%H%M%S).sql.gz
    
  - name: redis-dump
    run: kubectl exec redis-pod -- redis-cli --rdb /tmp/dump.rdb && kubectl exec redis-pod -- cat /tmp/dump.rdb
    output: file:backup-redis-$(date +%Y%m%d-%H%M%S).rdb
    
  - name: config-backup
    run: kubectl get configmaps -o yaml | gzip
    output: file:backup-configmaps-$(date +%Y%m%d-%H%M%S).yaml.gz
    
  - name: secrets-backup
    run: kubectl get secrets -o yaml | gzip
    output: file:backup-secrets-$(date +%Y%m%d-%H%M%S).yaml.gz
    
  - name: persistent-volume-backup
    run: kubectl exec vscode -- tar czf - /mnt/data
    output: file:backup-pv-data-$(date +%Y%m%d-%H%M%S).tar.gz
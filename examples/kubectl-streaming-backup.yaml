name: kubectl-streaming-backup
description: Stream large directory backup with progress monitoring and compression

steps:
  - name: stream-large-backup
    run: kubectl exec vscode -- tar cf - /home/coder | pv -s 1G | gzip
    output: file:backup-vscode-large-$(date +%Y%m%d-%H%M%S).tar.gz
    
  - name: encrypted-backup
    run: kubectl exec vscode -- tar czf - /tmp | gpg --cipher-algo AES256 --symmetric --no-tty --batch --yes --passphrase="your-secure-password"
    output: file:backup-vscode-encrypted-$(date +%Y%m%d-%H%M%S).tar.gz.gpg
    
  - name: selective-backup
    run: kubectl exec vscode -- find /home/coder -name "*.go" -o -name "*.yaml" -o -name "*.md" | kubectl exec vscode -- tar czf - -T -
    output: file:backup-vscode-code-$(date +%Y%m%d-%H%M%S).tar.gz